## Тестовое задание
собрать docker-compose файл в котором будет:
1. nginx в качестве прокси для nuxt
2. бот для получения сертификатов от letsencrypt

настройка доменных имен и портов для nuxt осуществляется через переменные окружения, ssl сертификаты должны обновляться автоматически без вмешательства. 

# Инструкция



## Подготовка

1. Скачать, распаковать архив

2. Установить скриптам возможность исполнения

   ```bash
   chmode 755 deploy.sh deploy-env.sh
   ```

3. Запустить одним из способов:

   1. ### Домен указан в переменных окружения

      - Установить переменные окружения

        ```bash
        export NUXT_DOMAIN="example.ru"
        
        export NUXT_EMAIL="admin@example.ru"
        ```

        

      - Запустить скрипт 

        ```bash
        sudo deploy-env.sh
        ```

        

   2. ### Домен или домены указываются в командной строке

      - Запустить скрипт

        ```bash
        deploy.sh email <domain1 domain2 ...>"
        ```

        пример:
        
        ```bash
        sudo deploy.sh admin@example.ru example.ru test.ru server.su
        ```
        
        

## Как устроено

| Элемент                                   | Назначение                                                   |
| ----------------------------------------- | ------------------------------------------------------------ |
| **nginx**                                 | Директория с обратным прокси                                 |
| **nginx**/**production**                  | Директория для используемых в работе конфигурационных файлов и файлов сертификатов Let's Encrypt. Вначале она пустая, скриптами в нее переносятся создаваемые (обновляемые) сертификаты и конфигурационые файлы Nginx |
| **nginx**/**templates**                   | Директория с типовыми файлами конфигурации                   |
| **nginx**/**templates**/upstream.conf     | Файл в котором перечислены приложения для Nginx. Если кроме Nuxt будет еще, например, API-бекенд, то добавлять сюда |
| **nginx**/**templates**/app_template.conf | Файл конфигурации Nginx, с переменной домена, в который подставляются конкретные значения домена из скрипта через **envsubst** |
| **nginx**/docker-compose.yml              | Файл docker-compose, которым запускаются контейнеры Nginx и certbot |
| **nginx**/nginx.conf                      | Файл общих настроек Nginx, не зависящих от домена            |
| **nginx**/Dockerfile                      | Dockerfile для контейнера с Nginx                            |
| **nuxt**                                  | Папка с приложением Nuxt.js. В качестве примера задано приложение Hello World с сайта https://nuxtjs.org |
| docker-compose.yml                        | Файл docker-compose, которым запускается контейнер Nuxt.js Дополнительные контейнеры (БД, бэкенд и т.п.) прописывать сюда |
| deploy-env.sh                             | Скрипт запуска - если домен указан в переменных окруженния **NUXT_DOMAIN**, а email - в переменных окружения **NUXT_EMAIL** |
| deploy.sh                                 | Скрипт запуска, позволяет задать сразу несколько доменов deploy.sh email <domain1 domain2 ...>" |
| README.md                                 | этот файл                                                    |